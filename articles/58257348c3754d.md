---
title: "AWS CLI ã§ IAM ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹"
emoji: "ğŸ”§"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["AWS", "IAM"]
published: false
---

# æ¦‚è¦

IAM ãƒ­ãƒ¼ãƒ«ä½œæˆã¯ã€Œç©ºã® IAM ãƒ­ãƒ¼ãƒ«ã®ä½œæˆã€ã€Œä½œæˆã—ãŸ IAM ãƒ­ãƒ¼ãƒ«ã«è¨±å¯ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã€ã® 2ã‚¹ãƒ†ãƒƒãƒ—ã§è¡Œã†ã€‚


# IAM ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ

IAM ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹éš›ã«ã¯ã€ãƒ­ãƒ¼ãƒ«ã®åå‰ã¨ãƒ­ãƒ¼ãƒ«ã‚’å¼•ãå—ã‘ã‚‹å¯¾è±¡ã‚’æŒ‡å®šã™ã‚‹ã€‚

```bash
aws iam create-role \
  --role-name sample-role \
  --assume-role-policy-document \
'{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Service": "lambda.amazonaws.com"
            },
            "Action": "sts:AssumeRole"
        }
    ]
}'
```


# ä½œæˆã—ãŸ IAM ãƒ­ãƒ¼ãƒ«ã«ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒ


## ä½œæˆæ¸ˆã¿ã®ãƒãƒªã‚·ãƒ¼ã¾ãŸã¯ AWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒ

```bash
aws iam attach-role-policy \
  --role-name sample-role \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess
```


## ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã™ã‚‹å ´åˆ

```bash
aws iam create-policy \
  --policy-name sample-policy \
  --policy-document \
'{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "s3:ListBucket",
            "Resource": "arn:aws:s3:::sample_bucket"
        }
    ]
}'
```

```bash
aws iam attach-role-policy \
  --role-name sample-role \
  --policy-arn <ä½œæˆã—ãŸãƒãƒªã‚·ãƒ¼ã® ARN>
```

# å¾Œç‰‡ä»˜ã‘

```bash
# ãƒãƒªã‚·ãƒ¼ã‚’å…¨ã¦ãƒ‡ã‚¿ãƒƒãƒã—ãªã„ã¨ IAM ãƒ­ãƒ¼ãƒ«ã‚’å‰Šé™¤ã§ããªã„
# IAM ãƒ­ãƒ¼ãƒ«ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸãƒãƒªã‚·ãƒ¼ã® ARN ã‚’å–å¾—ã—ãƒ‡ã‚¿ãƒƒãƒã™ã‚‹
attached_policy=$( \
  aws iam list-attached-role-policies \
    --role-name sample-role \
    --query 'AttachedPolicies[*].PolicyArn' \
    --output text \
)
for policy in $attached_policy
do
  aws iam detach-role-policy \
    --role-name sample-role \
    --policy-arn $policy
done

aws iam delete-role --role-name sample-role

aws iam delete-policy --policy-arn <ä½œæˆã—ãŸãƒãƒªã‚·ãƒ¼ã® ARN>
```

# å‚è€ƒãƒšãƒ¼ã‚¸

- AWS ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’å§”ä»»ã™ã‚‹ãƒ­ãƒ¼ãƒ«ã®ä½œæˆ
    - https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_roles_create_for-service.html
- AWS JSON ãƒãƒªã‚·ãƒ¼ã®è¦ç´ : Principal
    - https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_elements_principal.html
- AWS CLI ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
    - `aws iam create-role`
        - https://docs.aws.amazon.com/cli/latest/reference/iam/create-role.html
    - `aws iam attach-role-policy`
        - https://docs.aws.amazon.com/cli/latest/reference/iam/attach-role-policy.html
    - `aws iam create-policy`
        - https://docs.aws.amazon.com/cli/latest/reference/iam/create-policy.html
    - `aws iam list-attached-role-policies`
        - https://docs.aws.amazon.com/cli/latest/reference/iam/list-attached-role-policies.html
    - `aws iam detach-role-policy`
        - https://docs.aws.amazon.com/cli/latest/reference/iam/detach-role-policy.html
    - `aws iam delete-role`
        - https://docs.aws.amazon.com/cli/latest/reference/iam/delete-role.html
    - `aws iam delete-policy`
        - https://docs.aws.amazon.com/cli/latest/reference/iam/delete-policy.html
